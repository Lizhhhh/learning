<div id="clock"></div>

<script>
    /**
     * 随着Web的发展,用户对于Web的实时推送要求越来越高,比如,工业运行监控、Web在
     * 线通讯、实时报价系统、在线游戏等,都需要将后台发生的变化主动地、实时地传送到浏览器
     * 端,而不需要用户手动地刷新页面。本文对过去和现在流行的Web实时推送技术进行了比较与总结.
     */


    /**
     * 一、双向通信
     * HTTP协议有一个缺陷:通信只能由客户端发起。举例来说,我们想了解今天的天气,只能是客户
     * 端向服务器发出请求,服务器返回查询结果。HTTP协议做不到服务器主动向客户推送信息。这
     * 种单向请求的特点,注定了如果服务器有连续状态变化,客户端要获知就非常麻烦。在WebSoket
     * 协议之前,有三种实现双向通信的方式:轮询(polling)、长轮询(long-polling)和iframe流
     * `(streaming)
     */

    /**
     * 1.轮询(polling)
     */
    let clockDiv = document.getElementById('clock');
    setInterval(() => {
        let xhr = new XMLHttpRequest;
        xhr.open('GET', '/clock', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                console.log(xhr.responseText);
                clockDiv.innerHTML = xhr.responseText;
            }
        }
        xhr.send();
    }, 1 * 1000);


    /**
     * 轮询 服务端
     */
    let express = require('express');
    let app = express();
    app.use(express.static(__dirname));
    app.get('/clock', function(req, res) {
        res.send(new Date().toLocaleDateString());
    });
    app.listen(8080);
</script>